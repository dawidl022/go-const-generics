\begin{figure}
    \begin{mathpar}
        \inferrule
        {
        (\type~t_A[\ov{\Phi}]~ [n]\tau) \in \ov{D}\\
        \tau_A = t_A[\ov{\tau}]
        }
        { \{ i \in \mathbb{Z} \mid 0 \le i < n \} = \indexbounds(\tau_A)}

        \inferrule
        {
        (\type~t_A[\alpha~\const, \ov{\Phi}]~ [\alpha]\tau) \in \ov{D}\\
        \tau_A = t_A[n, \ov{\tau}]
        }
        { \{ i \in \mathbb{Z} \mid 0 \le i < n \} = \indexbounds(\tau_A)}

        \gray{
        \inferrule
        {
        (\func~(x~\black{t_V[\ov{\alpha}]})~m(\ov{x~\tau})~\tau~\br{\return~e}) \in \ov{D} \\
        \theta = (\ov{\Phi \by \sigma})
        }
        {\mbody(t_V[\ov{\sigma}].m) = (x:t_V[\ov{\sigma}],\ov{x:\tau}).e[\theta]}
        }

        \inferrule
        {
        (\func~(x~t_A[\ov{\alpha}]) ~m(x_1~\kw{int},~x_2~\tau) ~t_A[\ov{\alpha}]~
        \br{ x[x_1] = x_2;~\return~x }) \in \ov{D}\\
        \tau_A = t_A[\ov{\tau}]
        }
        {\isarraysetmethod(\tau_A.m)}
    \end{mathpar}
    \caption{FGG auxiliary functions for reduction with arrays}
\end{figure}


\begin{figure}
    \begin{center}
        Value \qquad $v$ ::= $\tau_S\br{\ov{v}} \mid \tau_A\br{\ov{v}} \mid n$
    \end{center}

    \begin{center}
        \gray{
            \begin{minipage}{0.5\textwidth}
                \begin{tabular}{ll}
                    Evaluation context          & $E$ ::=                      \\
                    \quad Hole                  & \quad $\Hole$                \\
                    \quad Method call receiver  & \quad $E.m(\ov{e})$          \\
                    \quad Method call arguments & \quad $v.m(\ov{v},E,\ov{e})$
                \end{tabular}
            \end{minipage}
            \begin{minipage}{0.4\textwidth}
                \begin{tabular}{ll}
                    ~                                                                         \\
                    \quad Value literal          & \quad $\black{\tau_V}\br{\ov{v},E,\ov{e}}$ \\
                    \quad Select                 & \quad $E.f$                                \\
                    \quad \black{Index receiver} & \quad \black{$E[e]$}                       \\
                    \quad \black{Index argument} & \quad \black{$\tau_A\br{\ov{v}}[E]$}
                \end{tabular}
            \end{minipage}
        }
    \end{center}

    Reduction \hfill \fbox{$d \becomes e$}
    \begin{mathpar}

        \gray{
            \inferrule[r-field]
            { (\ov{f~t}) = \fields(\tau_S) }
            { \tau_S\br{\ov{v}}.f_i \becomes v_i }
        }

        \inferrule[r-index]
        {
            n \in \indexbounds(\tau_A)
        }
        { \tau_A\br{\ov{v}}[n] \becomes v_n }

        \gray{
            \inferrule[r-call]
            { (x : \black{t_V},\ov{x: t}).e = \mbody(\vtype(v).m) }
            { v.m(\ov{v}) \becomes e[x \by v, \ov{x \by v}] }
        }

        % potential ambiguity with regular r-call?
        % no, because isarraysetmethod(t_A.m) and body(t_A.m) are mutually exclusive
        \inferrule[r-array-set]
        {
            n \in \indexbounds(\tau_A) \\
            \isarraysetmethod(\tau_A.m) \\
        }
        { \tau_A\br{\ov{v}}.m(n, v) \becomes \tau_A\br{\ov{v}}[n := v]}

        \gray{
            \inferrule[r-context]
            { d \becomes e }
            { E[d] \becomes E[e] }
        }

    \end{mathpar}
    \caption{FGG reduction with arrays}
\end{figure}
